<!DOCTYPE html>
<html>

<head>

    <title>WebGL 3D Model Viewer Using three.js</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://sxia2.github.io/waist_project/Program4/three.js"></script>
    <script src="https://sxia2.github.io/waist_project/Program4/Detector.js"></script>
    <script src="https://sxia2.github.io/waist_project/Program4/OrbitControls.js"></script>
    <script src="https://sxia2.github.io/waist_project/Program4/OBJLoader.js"></script>
    <script src="https://sxia2.github.io/waist_project/Program4/GLTFLoader.js"></script>
    <script src="https://sxia2.github.io/waist_project/Program4/RoomEnvironment.js"></script>
    <script src="https://sxia2.github.io/waist_project/Program4/Box3.js"></script>

    <style>
        .myDiv {
            border: 5px outset red;
            background-color: lightblue;
            text-align: center;
        }

        table,
        th,
        td {
            border: 1px solid black;
        }
    </style>
</head>

<body>
    <table>
        <tr>
            <th>
                <p>Month</p>
            </th>
            <th>
                <p>Month</p>
            </th>
        </tr>
        <tr>
            <td>
                <p>Month</p>
            </td>
            <td id="webgl-container"> </td>
        </tr>
        <tr>
            <td>
                <p>Month</p>
            </td>
            <td>
                <p>Month</p>
            </td>
        </tr>
    </table>

    <script>

        if (!Detector.webgl) {
            Detector.addGetWebGLMessage();
        }

        var container;

        var camera, controls, scene, renderer;
        var lighting, ambient, keyLight, fillLight, backLight;

        init();
        animate();


        function init() {

            container = document.getElementById("webgl-container")
            // document.body.appendChild(container);

            /* Camera */

            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.set(0, 0, 5);
            camera.lookAt(0, 0, 0);
            // camera.zoom = 0.001
            /* Renderer */

            renderer = new THREE.WebGLRenderer();
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            // renderer.setClearColor(new THREE.Color("hsl(10, 10%, 10%)"));

            container.appendChild(renderer.domElement);

            /* Scene */
            pmremGenerator = new THREE.PMREMGenerator( renderer );
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x444444);
            scene.environment = pmremGenerator.fromScene( new RoomEnvironment(), 0.04 ).texture;
            // const color = 0x3f7b9d
            // const near = 10;
            // const far = 100;
            // scene.fog = new THREE.Fog(color, near, far);

            // lighting = true;
            // scene.background = new THREE.Color('white');

            ambient = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambient);

            keyLight = new THREE.DirectionalLight(0xffffff, 0.5);
            keyLight.position.set(0, 0, 5);

            fillLight = new THREE.DirectionalLight(0xffffff, 0.5);
            fillLight.position.set(10, 10, 10);

            backLight = new THREE.DirectionalLight(0x4697c4, 0.5);
            fillLight.position.set(10, 10, 10);

            var objLoader = new THREE.OBJLoader();

            var ship_material = new THREE.MeshPhongMaterial({

                color: 0x4282a6,
                emissive: 0x0,
                specular: 0xa44747,
                shininess: 59,
                flatShading: false,
                // wireframe: true

            });

            objLoader.load('./assets/SSFemale0.obj',
                function (obj) {
                    obj.traverse(function (child) {
                        // if (child instanceof THREE.Mesh) {
                        child.material = ship_material;
                        // }
                    });
                    scene.add(obj);
                }
            );
            /* define a plane*/
            geometry = new THREE.PlaneGeometry(1, 1);
            material = new THREE.MeshPhongMaterial({
                color: 0xffff00, side: THREE.DoubleSide, opacity: 0.5,
                transparent: true
            });
            plane = new THREE.Mesh(geometry, material);
            scene.add(plane);


            /* Controls */

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.25;
            controls.enableZoom = true;
            controls.minPolarAngle = 3.14 / 4
            controls.maxPolarAngle = 3.14 / 4
            /* Events */

            window.addEventListener('resize', onWindowResize, false);
            window.addEventListener('keydown', onKeyboardEvent, false);



        }


        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }

        function onKeyboardEvent(e) {

            if (e.code === 'KeyL') {

                lighting = !lighting;

                if (lighting) {

                    ambient.intensity = 0.25;
                    scene.add(keyLight);
                    scene.add(fillLight);
                    scene.add(backLight);

                } else {

                    ambient.intensity = 1.0;
                    scene.remove(keyLight);
                    scene.remove(fillLight);
                    scene.remove(backLight);

                }

            }

        }

        function animate() {

            requestAnimationFrame(animate);

            controls.update();

            render();

        }

        function render() {

            renderer.render(scene, camera);

        }

    </script>
</body>

</html>