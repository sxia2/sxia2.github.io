<!DOCTYPE html>
<html>

<head>

    <title>WebGL 3D Model Viewer Using three.js</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://sxia2.github.io/waist_project/Program4/three.js"></script>
    <script src="https://sxia2.github.io/waist_project/Program4/Detector.js"></script>
    <script src="https://sxia2.github.io/waist_project/Program4/OrbitControls.js"></script>
    <script src="https://sxia2.github.io/waist_project/Program4/OBJLoader.js"></script>
    <script src="https://sxia2.github.io/waist_project/Program4/GLTFLoader.js"></script>

    <script src="https://sxia2.github.io/waist_project/Program4/MTLLoader.js"></script>

    <style>
        .myDiv {
            border: 5px outset red;
            background-color: lightblue;
            text-align: center;
        }

        table,
        th,
        td {
            border: 1px solid black;
        }
    </style>
</head>

<body>
    <table>
        <tr>
            <th>
                <p>Month</p>
            </th>
            <th>
                <p>Month</p>
            </th>
        </tr>
        <tr>
            <td>
                <p>Month</p>
            </td>
            <td id="webgl-container"> </td>
        </tr>
        <tr>
            <td>
                <p>Month</p>
            </td>
            <td>
                <p>Month</p>
            </td>
        </tr>
    </table>

    <script>

        if (!Detector.webgl) {
            Detector.addGetWebGLMessage();
        }

        var container;

        var camera, controls, scene, renderer;
        var lighting, ambient, keyLight, fillLight, backLight;

        init();
        animate();

        function init() {

            container = document.getElementById("webgl-container")
            // document.body.appendChild(container);

            /* Camera */

            camera = new THREE.PerspectiveCamera(window.innerHeight/10, window.innerWidth / window.innerHeight, 1, 1000);
            camera.position.z = 3;

            /* Scene */

            scene = new THREE.Scene();
            lighting = true;

            ambient = new THREE.AmbientLight(0xffffff, 1.0);
            scene.add(ambient);

            keyLight = new THREE.DirectionalLight(new THREE.Color('hsl(30, 100%, 75%)'), 1.0);
            keyLight.position.set(-100, 0, 100);

            fillLight = new THREE.DirectionalLight(new THREE.Color('hsl(240, 100%, 75%)'), 0.75);
            fillLight.position.set(100, 0, 100);

            backLight = new THREE.DirectionalLight(0xffffff, 1.0);
            backLight.position.set(100, 0, -100).normalize();

            var objLoader = new THREE.OBJLoader();

            material = new THREE.MeshStandardMaterial({

                color: 0xffffff,
                roughness: 1.0,
                metalness: 0.0,

            });

            // objLoader.setMaterials(mirrorMaterial);
            objLoader.load('./assets/SSFemale0.obj', function (object) {
                // const geometry = object.children[0].geometry;
                // geometry.attributes.uv2 = geometry.attributes.uv;
                // geometry.center();

                // mesh = new THREE.Mesh(geometry, material);
                // mesh.scale.multiplyScalar(25);
                scene.add(object);

            });

            // camera.position = objLoader.position;
            boundingBox = new THREE.Box3();
            center = boundingBox.getCenter();

            /* Renderer */

            renderer = new THREE.WebGLRenderer();
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(new THREE.Color("hsl(10, 10%, 10%)"));


            /* Controls */

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.25;
            controls.enableZoom = true;
            controls.minPolarAngle = 3.14/4
            controls.maxPolarAngle = 3.14/4
            /* Events */

            window.addEventListener('resize', onWindowResize, false);
            window.addEventListener('keydown', onKeyboardEvent, false);

            container.appendChild(renderer.domElement);


        }

        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }

        function onKeyboardEvent(e) {

            if (e.code === 'KeyL') {

                lighting = !lighting;

                if (lighting) {

                    ambient.intensity = 0.25;
                    scene.add(keyLight);
                    scene.add(fillLight);
                    scene.add(backLight);

                } else {

                    ambient.intensity = 1.0;
                    scene.remove(keyLight);
                    scene.remove(fillLight);
                    scene.remove(backLight);

                }

            }

        }

        function animate() {

            requestAnimationFrame(animate);

            controls.update();

            render();

        }

        function render() {

            renderer.render(scene, camera);

        }

    </script>
</body>

</html>